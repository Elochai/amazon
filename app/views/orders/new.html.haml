.container
  %center 
    - if customer_signed_in? && current_customer.order_items.in_cart.empty?
      %h2
        %strong.label.label-warning= t(:empty_cart)
    - else 
      == #{link_to t(:clear_cart), clear_cart_path, data: {confirm: t(:are_you_sure)}, class:'btn btn-warning'}
      %h2= t(:new_order)
      %table.table.table-hover.table-small
        %thead
          %tr.success
            %th.text-center= t(:book_title)
            %th.text-center= t(:author_name)
            %th.text-center= t(:category_name)
            %th.text-center= t(:quantity)
            %th.text-center= t(:price)
            %th.text-center= t(:manage)
          %tbody
            -  current_customer.order_items.in_cart.each do |oi|
              %tr.text-center
                %td= oi.book.title
                %td= oi.book.author.full_name
                %td= oi.book.category.title
                %td= oi.quantity
                %td= number_to_currency(oi.price)
                %td== #{link_to '', edit_order_item_path(oi), class: 'icon-pencil', title: t(:change_oi_quantity)} | #{link_to "", order_item_path(oi), method: :delete, data: {confirm: t(:are_you_sure)}, class:'icon-trash', title: t(:remove_from_cart)}
      %center
        %h3== #{t(:total_price)} <span class="label label-primary">#{number_to_currency(current_customer.order_price)}</span> 
        = form_for @order do |order|
          = render partial: "errors/errors", locals: {object: order.object}
          = order.hidden_field :state, value: "in_progress" 
          = order.hidden_field :price, value: "#{current_customer.order_price}"
          %h3= t(:order_info) 
          - if current_customer.credit_card.nil?
            %h4
              = order.fields_for :credit_card do |cc|
                .panel.panel-info.panel-small#cc
                  .panel-heading
                    = t(:cc_info)
                  .panel-body
                    %h5
                      %label.control-label== #{t(:cc_number)} #{cc.text_field :number, class: 'form-control'}
                      %label.control-label== #{t(:cvv)}: #{cc.number_field :cvv, step: 1, class: 'form-control s'}
                      %label.control-label== #{t(:owner_fn)} #{cc.text_field :firstname, size: 8, class: 'form-control'}
                      %label.control-label== #{t(:owner_ln)}: #{cc.text_field :lastname, size: 8, class: 'form-control'}
                      %label.control-label== #{t(:exp_m)} #{cc.number_field :expiration_month, in: 1..12, size: 4, class: 'form-control'}
                      %label.control-label== #{t(:exp_y)} #{cc.number_field :expiration_year, min: Time.now.year, max: Time.now.year + 30, class: 'form-control'} 
          - else
            %h4
              = order.fields_for :credit_card do |cc|
                .panel.panel-info.panel-small#cc
                  .panel-heading
                    = t(:cc_info)
                  .panel-body
                    %h5
                      %label.control-label== #{t(:cc_number)} #{cc.text_field :number, class: 'form-control', value: "#{current_customer.credit_card.number}"}
                      %label.control-label== #{t(:cvv)} #{cc.number_field :cvv, step: 1, class: 'form-control s', value: "#{current_customer.credit_card.cvv}"}
                      %label.control-label== #{t(:owner_fn)} #{cc.text_field :firstname, size: 8, class: 'form-control', value: "#{current_customer.credit_card.firstname}"}
                      %label.control-label== #{t(:owner_ln)} #{cc.text_field :lastname, size: 8, class: 'form-control', value: "#{current_customer.credit_card.lastname}"}
                      %label.control-label== #{t(:exp_m)} #{cc.number_field :expiration_month, in: 1..12, size: 4, class: 'form-control', value: "#{current_customer.credit_card.expiration_month}"}
                      %label.control-label== #{t(:exp_y)} #{cc.number_field :expiration_year, min: Time.now.year, max: Time.now.year + 30, class: 'form-control', value: "#{current_customer.credit_card.expiration_year}"} 
          - if current_customer.bill_address.nil?
            .inline
              %h4
                = order.fields_for :bill_address do |ba|
                  .panel.panel-info.panel-little#ba
                    .panel-heading
                      = t(:ba_info)
                    .panel-body
                      %h5
                        %label.control-label== #{t(:country)} <br>#{ba.select :country_id, options_from_collection_for_select(Country.all, :id, :name), {:include_blank => 'Country'}, {:class => 'form-control'}}
                        %br
                        %br
                        %label.control-label== #{t(:city)} #{ba.text_field :city, size: 15, class: 'form-control'}
                        %br
                        %br
                        %label.control-label== #{t(:address)} #{ba.text_area :address, class: 'form-control'}
                        %br
                        %br
                        %label.control-label== #{t(:zipcode)} #{ba.number_field :zipcode, class: 'form-control s'}
                        %br
                        %br
                        %label.control-label== #{t(:phone)} #{ba.telephone_field :phone, class: 'form-control'}
          - else
            .inline
              %h4
                = order.fields_for :bill_address do |ba|
                  .panel.panel-info.panel-little#ba
                    .panel-heading
                      = t(:ba_info)
                    .panel-body
                      %h5
                        %label.control-label== #{t(:country)} <br>#{ba.select :country_id, options_from_collection_for_select(Country.all, :id, :name, "#{current_customer.bill_address.country_id}"), {:include_blank => 'Country'}, {:class => 'form-control'}}
                        %br
                        %br
                        %label.control-label== #{t(:city)} #{ba.text_field :city, size: 15, class: 'form-control', value: "#{current_customer.bill_address.city}"}
                        %br
                        %br
                        %label.control-label== #{t(:address)} #{ba.text_area :address, class: 'form-control', value: "#{current_customer.bill_address.address}"}
                        %br
                        %br
                        %label.control-label== #{t(:zipcode)} #{ba.number_field :zipcode, class: 'form-control s', value: "#{current_customer.bill_address.zipcode}"}
                        %br
                        %br
                        %label.control-label== #{t(:phone)} #{ba.telephone_field :phone, class: 'form-control', value: "#{current_customer.bill_address.phone}"}
          - if current_customer.ship_address.nil?
            .inline
              %h4 
                = order.fields_for :ship_address do |sa|
                  .panel.panel-info.panel-little#sa
                    .panel-heading
                      = t(:sa_info)
                    .panel-body
                      %h5
                        %label.control-label== #{t(:country)} <br>#{sa.select :country_id, options_from_collection_for_select(Country.all, :id, :name), {:include_blank => 'Country'}, {:class => 'form-control'}}
                        %br
                        %br
                        %label.control-label== #{t(:city)} #{sa.text_field :city, size: 15, class: 'form-control'}
                        %br
                        %br
                        %label.control-label== #{t(:address)} #{sa.text_area :address, class: 'form-control'}
                        %br
                        %br
                        %label.control-label== #{t(:zipcode)}: #{sa.number_field :zipcode, class: 'form-control s'}
                        %br
                        %br
                        %label.control-label== #{t(:phone)} #{sa.telephone_field :phone, class: 'form-control'}
          - else
            .inline
              %h4
                = order.fields_for :ship_address do |sa|
                  .panel.panel-info.panel-little#sa
                    .panel-heading
                      = t(:sa_info)
                    .panel-body
                      %h5
                        %label.control-label== #{t(:country)} <br>#{sa.select :country_id, options_from_collection_for_select(Country.all, :id, :name, "#{current_customer.ship_address.country_id}"), {:include_blank => 'Country'}, {:class => 'form-control'}}
                        %br
                        %br
                        %label.control-label== #{t(:city)} #{sa.text_field :city, size: 15, class: 'form-control', value: "#{current_customer.ship_address.city}"}
                        %br
                        %br
                        %label.control-label== #{t(:address)} #{sa.text_area :address, class: 'form-control', value: "#{current_customer.ship_address.address}"}
                        %br
                        %br
                        %label.control-label== #{t(:zipcode)}: #{sa.number_field :zipcode, class: 'form-control s', value: "#{current_customer.ship_address.zipcode}"}
                        %br
                        %br
                        %label.control-label== #{t(:phone)} #{sa.telephone_field :phone, class: 'form-control', value: "#{current_customer.ship_address.phone}"}
          .outline
            = order.submit t(:buy), class: "btn btn-lg btn-success"